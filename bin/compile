#!/bin/sh

# Installs apache thrift
# following directions from here:
# https://thrift.apache.org/docs/BuildingFromSource

indent() {
  sed -u 's/^/       /'
}

echo "-----> Unzipping thrift-0.13.0"

gunzip thrift.gz | indent

echo "-----> Copying to ${HOME}/vendor/bin"

mkdir -p ${HOME}/vendor/bin
cp thrift ${HOME}/vendor/bin/thrift

chmod +x "${HOME}/vendor/bin/thrift"

$HOME/vendor/bin/thrift -version | indent

echo '-----> Adding vendor/bin to $PATH for future buildpacks'

export PATH="$PATH:${HOME}/vendor/bin"

echo '-----> Adding $PATH to the profile'

PROFILE_PATH="$1/.profile.d/apache-thrift.sh"
mkdir -p $(dirname $PROFILE_PATH)
echo 'export PATH="$PATH:${HOME}/vendor/bin"' >> $PROFILE_PATH
