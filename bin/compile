#!/bin/sh

# Installs apache thrift
# following directions from here:
# https://thrift.apache.org/docs/BuildingFromSource

indent() {
  sed -u 's/^/       /'
}

echo "-----> Unpacking tarball"

tar xfz thrift-0.13.0.tar.gz | indent

echo "-----> cd thrift-0.13.0"

cd thrift-0.13.0 

echo "-----> Running ./configure"

./configure --without-as3 --without-cpp --without-qt5 --without-c_glib --without-csharp --without-java  --without-erlang --without-nodejs --without-nodets --without-lua --without-python --without-perl --without-php --without-php_extension  --without-dart --without-ruby --without-haskell --without-go --without-swift --without-rs --without-cl --without-haxe --without-dotnetcore --without-d --prefix=$HOME/vendor | indent

echo "-----> Running make"

make | indent

echo "-----> Running make install"

make install | indent

echo "-----> Adding $PATH to the profile"

PROFILE_PATH="$1/.profile.d/apache-thrift.sh"
mkdir -p $(dirname $PROFILE_PATH)
echo 'export PATH="$PATH:${HOME}/vendor/bin"' >> $PROFILE_PATH

echo "-----> Testing for thrift binary"

if command -v thrift; then
  echo "-----> Success!!"
else
  echo "-----> FAILED"
fi
